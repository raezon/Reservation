!function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function t(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}function r(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function n(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))}Object.create;function i(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(e){return this instanceof s?(this.v=e,this):new s(e)}function o(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),o=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){o.push([e,t,r,n])>1||c(e,t)}))})}function c(e,t){try{(r=i[e](t)).value instanceof s?Promise.resolve(r.value.v).then(l,d):u(o[0][2],r)}catch(e){u(o[0][3],e)}var r}function l(e){c("next",e)}function d(e){c("throw",e)}function u(e,t){e(t),o.shift(),o.length&&c(o[0][0],o[0][1])}}function a(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:s(e[n](t)),done:"return"===n}:i?i(t):t}:i}}function c(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=i(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,i,(t=e[r](t)).done,t.value)}))}}}Object.create;class l{constructor(e){const t=l.RFC_3986.exec(e);if(!t)throw new Error("Invalid Uri: "+e);const[,,r,,n,i,,s,,o]=t;this.scheme=r,this.authority=n?new d(n):void 0,this.path=i,this.query=s,this.fragment=o}toString(){const e=[];return void 0!==this.scheme&&e.push(this.scheme,":"),void 0!==this.authority&&e.push("//",this.authority.toString()),e.push(this.path),void 0!==this.query&&e.push("?",this.query),void 0!==this.fragment&&e.push("#",this.fragment),e.join("")}get host(){return this.authority&&this.authority.host}get port(){return this.authority&&this.authority.port}get userInfo(){return this.authority&&this.authority.userInfo}}l.RFC_3986=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;class d{constructor(e){const t=d.RFC_3986.exec(e);if(!t)throw new Error("Invalid Authority: "+e);const[,r,n,i]=t;this.userInfo=r,this.host=n,this.port=i}toString(){const e=[];return void 0!==this.userInfo&&e.push(this.userInfo,"@"),void 0!==this.host&&e.push(this.host),void 0!==this.port&&e.push(":",this.port),e.join("")}}d.RFC_3986=/(?:([^@]+)@)?([^:]+)(?::([\d]+))?/;var u={};Object.defineProperty(u,"__esModule",{value:!0});var h=(he=void 0,ge=u.IdentityTransducer=he,ye=u.identity=ge,me=u.transducer=ye,we=u.FirstTransducer=me,ke=u.first=we,xe=u.LastTransducer=ke,Ie=u.last=xe,Ae=u.MapTransducer=Ie,Ce=u.map=Ae,Pe=u.ZipTransducer=Ce,He=u.zip=Pe,Te=u.zipWithIndex=He,Le=u.FlatMapTransducer=Te,Re=u.flatMap=Le,Me=u.FilterTransducer=Re,_e=u.filter=Me,Ne=u.reject=_e,De=u.find=Ne,Fe=u.CompositeTransducer=De,$e=u.compose=Fe,Ue=u.decompose=$e,Ke=u.ScanTransducer=Ue,Ze=u.scan=Ke,Xe=u.reduce=Ze,Qe=u.TakeTransducer=Xe,et=u.take=Qe,tt=u.DropTransducer=et,nt=u.drop=tt,it=u.DropWhileTransducer=nt,ot=u.dropWhile=it,at=u.TakeWhileTransducer=ot,lt=u.takeWhile=at,dt=u.SortTransducer=lt,ht=u.sort=dt,ft=u.DedupTransducer=ht,yt=u.dedupe=ft,pt=u.UniqueTransducer=yt,mt=u.unique=pt,u.windowed=mt);u.WindowedTransducer=h;var f={};Object.defineProperty(f,"__esModule",{value:!0});var g=(T=void 0,L=f.ascending=T,q=f.descending=L,R=f.comparators=q,B=f.key=R,_=f.value=B,N=f.isIterable=_,z=f.isAsyncIterable=N,D=f.isPromiseLike=z,W=f.toIterable=D,F=f.iterable=W,G=f.asyncIterable=F,U=f.isArrayLike=G,V=f.array=U,K=f.toAsyncIterable=V,f.by=K);f.single=g;var y={};Object.defineProperty(y,"__esModule",{value:!0});var p=(x=void 0,S=y.iterate=x,I=y.repeat=S,E=y.range=I,P=y.sequence=E,y.Sequence=P);y.AsyncSequence=p;var m={};Object.defineProperty(m,"__esModule",{value:!0});var v=(w=void 0,b=m.increment=w,k=m.add=b,m.subtract=k);m.sum=v;var w=function(e){return e+1};m.increment=w;var b=function(e,t){return void 0===t?t=>e+t:e+t};m.add=b;var k=function(e,t){return void 0===t?t=>t-e:e-t};function*O(e,t){for(;;)yield t,t=e(t)}m.subtract=k,v=(e,t)=>e+t,m.sum=v;var x=O;y.iterate=x;var S=function*(e){for(;;)yield e()};y.repeat=S;var I=function*(e,t,r=1){if(0===r)throw new Error("step can not be 0");if(void 0===t)yield*O(m.add(r),e);else{const n=Math.abs(r);t<e?yield*A(O(m.subtract(n),e),u.takeWhile((e=>e>=t))):yield*A(O(m.add(n),e),u.takeWhile((e=>e<=t)))}};function A(e,...t){return f.isIterable(e)?new C(e,t):f.isArrayLike(e)?new C(f.iterable(e),t):new H(e,t)}y.range=I;var E=A;y.sequence=E;class C{constructor(e,t){this.source=e,this.transducers=t}[Symbol.iterator](){return this.transducers.reduce(((e,t)=>t.sync(e)),this.source)[Symbol.iterator]()}}var P=C;y.Sequence=P;class H{constructor(e,t){this.source=e,this.transducers=t}[Symbol.asyncIterator](){return this.transducers.reduce(((e,t)=>t.async_(e)),this.source)[Symbol.asyncIterator]()}}function j(e,t){return e<t?-1:e>t?1:0}p=H,y.AsyncSequence=p;var T=j;f.ascending=T;var L=function(e,t){return e<t?1:e>t?-1:0};f.descending=L;var q=function(...e){return(t,r)=>{for(const n of e){const e=n(t,r);if(0!=e)return e}return 0}};f.comparators=q;var R=function(e){return Object.assign((t=>t[e]),{name:e})};f.key=R;var B=function(e){return t=>t[e]};function M(e){return"object"==typeof e&&Symbol.iterator in e}f.value=B;var _=M;f.isIterable=_;var N=function(e){return"object"==typeof e&&Symbol.asyncIterator in e};f.isAsyncIterable=N;var z=function(e){return"object"==typeof e&&"then"in e};f.isPromiseLike=z;var D=function(...e){return e};f.toIterable=D;var W=function*(e){for(let t=0;t<e.length;t++)yield e[t]};f.iterable=W;var F=function(e){return o(this,arguments,(function*(){for(const t of e)yield yield s(t)}))};function $(e){return"object"==typeof e&&"number"==typeof e.length}f.asyncIterable=F;var G=$;f.isArrayLike=G;var U=function(e,...t){return M(e)||$(e)?function(e){const t=[];for(const r of e)t.push(r);return t}(y.sequence(e,...t)):function(e){var t,r,i,s;return n(this,void 0,void 0,(function*(){const n=[];try{for(t=c(e);!(r=yield t.next()).done;){const e=r.value;n.push(e)}}catch(e){i={error:e}}finally{try{r&&!r.done&&(s=t.return)&&(yield s.call(t))}finally{if(i)throw i.error}}return n}))}(y.sequence(e,...t))};f.array=U;var V=function(e){return o(this,arguments,(function*(){yield yield s(e)}))};f.toAsyncIterable=V;var K=function(e,t=j){return"function"==typeof e?function(e,t=j){return(r,n)=>t(e(r),e(n))}(e,t):function(e,t=j){return(r,n)=>t(r[e],n[e])}(e,t)};f.by=K,g=function(e,...t){return M(e)?function(e){for(const t of e)return t;throw new Error("Expected a single value")}(y.sequence(e,...t)):function(e){var t,r,i,s;return n(this,void 0,void 0,(function*(){try{for(t=c(e);!(r=yield t.next()).done;){return r.value}}catch(e){i={error:e}}finally{try{r&&!r.done&&(s=t.return)&&(yield s.call(t))}finally{if(i)throw i.error}}throw new Error("Expected a single value")}))}(y.sequence(e,...t))},f.single=g;var Z={};Object.defineProperty(Z,"__esModule",{value:!0});var J=void 0;Z.AVLTree=J;var X={};Object.defineProperty(X,"__esModule",{value:!0});var Q=(ee=void 0,re=X.replace=ee,X.lazy=re);function Y(e,t,r){return Object.defineProperty(e,t,{value:r})}X.container=Q;var ee=Y;function te(e,t,r){if(void 0===r.get)throw new Error("@lazy can only decorate getter methods");return Object.defineProperty(e,t,Object.assign(Object.assign({},r),{get(){return Y(this,t,r.get.call(this))[t]}}))}X.replace=ee;var re=te;X.lazy=re,Q=function(e){return Object.keys(e).reduce(((t,r)=>te(t,r,{configurable:!0,get:()=>e[r](t)})),{})},X.container=Q;class ne{constructor(e){this.comparator=e}static empty(e=f.ascending){return new ie(e)}static create(e,t,r=f.ascending){const n=ne.empty(r);return new se(r,e,t,n,n)}static of(e,t=f.ascending){return ne.preSorted(e.sort(f.by(0)),t,ne.empty(t))}static preSorted(e,t,r){const n=e.length;switch(n){case 0:return r;case 1:{const[[n,i]]=e;return new se(t,n,i,r,r)}default:{const i=Math.floor(n/2),s=ne.preSorted(e.slice(0,i),t,r),o=ne.preSorted(e.slice(i+1),t,r),[a,c]=e[i];return new se(t,a,c,s,o)}}}}J=ne,Z.AVLTree=J;class ie extends ne{constructor(e){super(e),this.isEmpty=!0,this.height=0,this.balance=0}insert(e,t){return new se(this.comparator,e,t,this,this)}contains(e){return!1}lookup(e){}delete(e){return{tree:this}}first(){}last(){}removeFirst(){return{tree:this}}removeLast(){return{tree:this}}toString(){return""}*keys(){}*values(){}*entries(){return[]}}class se extends ne{constructor(e,t,r,n,i){super(e),this.key=t,this.value=r,this.left=n,this.right=i,this.isEmpty=!1}insert(e,t){const r=this.comparator(e,this.key);return 0===r?new se(this.comparator,e,t,this.left,this.right):r<0?this.replaceLeft(this.left.insert(e,t)):this.replaceRight(this.right.insert(e,t))}contains(e){const t=this.comparator(e,this.key);return 0===t||(t<0?this.left.contains(e):this.right.contains(e))}lookup(e){const t=this.comparator(e,this.key);return 0===t?this.value:t<0?this.left.lookup(e):this.right.lookup(e)}delete(e){const t=this.comparator(e,this.key);if(0===t){if(this.left.isEmpty)return{tree:this.right,key:this.key,value:this.value};if(this.right.isEmpty)return{tree:this.left,key:this.key,value:this.value};const{tree:e,key:t,value:r}=this.left.removeLast();return{tree:oe(new se(this.comparator,t,r,e,this.right)),key:this.key,value:this.value}}if(t<0){const{tree:t,key:r,value:n}=this.left.delete(e);return{tree:this.replaceLeft(t),key:r,value:n}}const{tree:r,key:n,value:i}=this.right.delete(e);return{tree:this.replaceRight(r),key:n,value:i}}first(){return this.left.isEmpty?this.value:this.left.first()}last(){return this.right.isEmpty?this.value:this.right.last()}removeFirst(){if(this.left.isEmpty)return{tree:this.right,key:this.key,value:this.value};const{tree:e,key:t,value:r}=this.left.removeFirst();return{tree:this.replaceLeft(e),key:t,value:r}}removeLast(){if(this.right.isEmpty)return{tree:this.left,key:this.key,value:this.value};const{tree:e,key:t,value:r}=this.right.removeLast();return{tree:this.replaceRight(e),key:t,value:r}}replaceLeft(e){return oe(new se(this.comparator,this.key,this.value,e,this.right))}replaceRight(e){return oe(new se(this.comparator,this.key,this.value,this.left,e))}toString(){return`(${this.left} ${this.key}=${this.value} ${this.right})`}get balance(){return this.left.height-this.right.height}get height(){return Math.max(this.left.height,this.right.height)+1}*keys(){yield*this.left.keys(),yield this.key,yield*this.right.keys()}*values(){yield*this.left.values(),yield this.value,yield*this.right.values()}*entries(){yield*this.left.entries(),yield[this.key,this.value],yield*this.right.entries()}}function oe(e){const t=e.balance;return-2==t?function(e){const t=e.right.balance;return 1==t?function(e){const t=de(e.right);return ce(e.replaceRight(t))}(e):-1==t?ce(e):e}(e):2==t?function(e){const t=e.left.balance;return-1==t?function(e){const t=le(e.left);return ae(e.replaceLeft(t))}(e):1==t?ae(e):e}(e):e}function ae(e){return de(e)}function ce(e){return le(e)}function le(e){const t=e.right,r=t.left,n=e.replaceRight(r);return t.replaceLeft(n)}function de(e){const t=e.left,r=t.right,n=e.replaceLeft(r);return t.replaceRight(n)}t([X.lazy],se.prototype,"balance",null),t([X.lazy],se.prototype,"height",null);class ue{async_(e){return e}sync(e){return e}}var he=ue;function fe(){return new ue}u.IdentityTransducer=he;var ge=fe;u.identity=ge;var ye=fe;u.transducer=ye;class pe{async_(e){return o(this,arguments,(function*(){var t,r;try{for(var n,i=c(e);!(n=yield s(i.next())).done;){const e=n.value;return yield s(yield yield s(e))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&(yield s(r.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e)return yield t}}var me=pe;function ve(){return new pe}u.FirstTransducer=me;var we=ve;u.first=we;class be{async_(e){return o(this,arguments,(function*(){var t,r;let n;try{for(var i,o=c(e);!(i=yield s(o.next())).done;)n=i.value}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&(yield s(r.call(o)))}finally{if(t)throw t.error}}void 0!==n&&(yield yield s(n))}))}*sync(e){let t;for(t of e);void 0!==t&&(yield t)}}var ke=be;function Oe(){return new be}u.LastTransducer=ke;var xe=Oe;u.last=xe;class Se{constructor(e){this.mapper=e}async_(e){return o(this,arguments,(function*(){var t,r;try{for(var n,i=c(e);!(n=yield s(i.next())).done;){const e=n.value;yield yield s(this.mapper(e))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&(yield s(r.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e)yield this.mapper(t)}}var Ie=Se;u.MapTransducer=Ie;var Ae=function(e){return new Se(e)};u.map=Ae;class Ee{constructor(e){this.other=e}async_(e){return o(this,arguments,(function*(){if(!f.isAsyncIterable(this.other))throw new Error("Unsupported operation exception");const t=e[Symbol.asyncIterator](),r=this.other[Symbol.asyncIterator]();for(;;){const[e,n]=yield s(Promise.all([t.next(),r.next()]));if(e.done||n.done)return yield s(void 0);yield yield s([e.value,n.value])}}))}*sync(e){if(!f.isIterable(this.other))throw new Error("Unsupported operation exception");const t=e[Symbol.iterator](),r=this.other[Symbol.iterator]();for(;;){const e=t.next(),n=r.next();if(e.done||n.done)return;yield[e.value,n.value]}}}var Ce=Ee;u.ZipTransducer=Ce;var Pe=function(e){return new Ee(e)};u.zip=Pe;var He=function(){return new Ee(y.range(0))};u.zipWithIndex=He;class je{constructor(e){this.mapper=e}async_(e){return o(this,arguments,(function*(){var t,r;try{for(var n,i=c(e);!(n=yield s(i.next())).done;){const e=n.value;yield s(yield*a(c(this.mapper(e))))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&(yield s(r.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e)yield*this.mapper(t)}}var Te=je;u.FlatMapTransducer=Te;var Le=function(e){return new je(e)};u.flatMap=Le;class qe{constructor(e){this.predicate=e}async_(e){return o(this,arguments,(function*(){var t,r;try{for(var n,i=c(e);!(n=yield s(i.next())).done;){const e=n.value;this.predicate(e)&&(yield yield s(e))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&(yield s(r.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e)this.predicate(t)&&(yield t)}}var Re=qe;function Be(e){return new qe(e)}u.FilterTransducer=Re;var Me=Be;u.filter=Me;var _e=function(e){return new qe((t=>!e(t)))};u.reject=_e;var Ne=function(e){return We(Be(e),ve())};u.find=Ne;class ze{constructor(e,t){this.a=e,this.b=t}async_(e){return this.b.async_(this.a.async_(e))}sync(e){return this.b.sync(this.a.sync(e))}}var De=ze;function We(e,t){return new ze(e,t)}u.CompositeTransducer=De;var Fe=We;u.compose=Fe;var $e=function*e(t){t instanceof ze?(yield*e(t.a),yield*e(t.b)):yield t};u.decompose=$e;class Ge{constructor(e,t){this.reducer=e,this.seed=t}async_(e){return o(this,arguments,(function*(){var t,r;let n=this.seed;yield yield s(n);try{for(var i,o=c(e);!(i=yield s(o.next())).done;){const e=i.value;yield yield s(n=this.reducer(n,e))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&(yield s(r.call(o)))}finally{if(t)throw t.error}}}))}*sync(e){let t=this.seed;yield t;for(const r of e)yield t=this.reducer(t,r)}}var Ue=Ge;function Ve(e,t){return new Ge(e,t)}u.ScanTransducer=Ue;var Ke=Ve;u.scan=Ke;var Ze=function(e,t){return We(Ve(e,t),Oe())};u.reduce=Ze;class Je{constructor(e){if(this.count=e,void 0===e)throw new Error("Count can not be undefined")}async_(e){return o(this,arguments,(function*(){var t,r;if(this.count<1)return yield s(void 0);try{for(var n,i=c(e);!(n=yield s(i.next())).done;){const e=n.value;if(yield yield s(e),--this.count<1)return yield s(void 0)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&(yield s(r.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){if(!(this.count<1))for(const t of e)if(yield t,--this.count<1)return}}var Xe=Je;u.TakeTransducer=Xe;var Qe=function(e){return new Je(e)};u.take=Qe;class Ye{constructor(e){if(this.count=e,void 0===e)throw new Error("Count can not be undefined")}async_(e){return o(this,arguments,(function*(){var t,r;try{for(var n,i=c(e);!(n=yield s(i.next())).done;){const e=n.value;--this.count<0&&(yield yield s(e))}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&(yield s(r.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e)--this.count<0&&(yield t)}}var et=Ye;u.DropTransducer=et;var tt=function(e){return new Ye(e)};u.drop=tt;class rt{constructor(e){this.predicate=e}async_(e){return o(this,arguments,(function*(){var t,r;let n=!0;try{for(var i,o=c(e);!(i=yield s(o.next())).done;){const e=i.value;n&&(n=this.predicate(e)),n||(yield yield s(e))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&(yield s(r.call(o)))}finally{if(t)throw t.error}}}))}*sync(e){let t=!0;for(const r of e)t&&(t=this.predicate(r)),t||(yield r)}}var nt=rt;u.DropWhileTransducer=nt;var it=function(e){return new rt(e)};u.dropWhile=it;class st{constructor(e){this.predicate=e}async_(e){return o(this,arguments,(function*(){var t,r;try{for(var n,i=c(e);!(n=yield s(i.next())).done;){const e=n.value;if(!this.predicate(e))return yield s(void 0);yield yield s(e)}}catch(e){t={error:e}}finally{try{n&&!n.done&&(r=i.return)&&(yield s(r.call(i)))}finally{if(t)throw t.error}}}))}*sync(e){for(const t of e){if(!this.predicate(t))return;yield t}}}var ot=st;u.TakeWhileTransducer=ot;var at=function(e){return new st(e)};u.takeWhile=at;class ct{constructor(e){this.comparator=e}async_(e){return o(this,arguments,(function*(){const t=yield s(f.array(e));t.sort(this.comparator),yield s(yield*a(c(t)))}))}*sync(e){const t=f.array(e);t.sort(this.comparator),yield*t}}var lt=ct;u.SortTransducer=lt;var dt=function(e=f.ascending){return new ct(e)};u.sort=dt;class ut{constructor(e){this.comparator=e}async_(e){return o(this,arguments,(function*(){var t,r;let n;try{for(var i,o=c(e);!(i=yield s(o.next())).done;){const e=i.value;(void 0===n||0!==this.comparator(e,n))&&(yield yield s(e)),n=e}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&(yield s(r.call(o)))}finally{if(t)throw t.error}}}))}*sync(e){let t;for(const r of e)(void 0===t||0!==this.comparator(r,t))&&(yield r),t=r}}var ht=ut;u.DedupTransducer=ht;var ft=function(e=f.ascending){return new ut(e)};u.dedupe=ft;class gt{constructor(e){this.comparator=e}async_(e){return o(this,arguments,(function*(){var t,r;let n=Z.AVLTree.empty(this.comparator);try{for(var i,o=c(e);!(i=yield s(o.next())).done;){const e=i.value;n.contains(e)||(n=n.insert(e,void 0),yield yield s(e))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&(yield s(r.call(o)))}finally{if(t)throw t.error}}}))}*sync(e){let t=Z.AVLTree.empty(this.comparator);for(const r of e)t.contains(r)||(t=t.insert(r,void 0),yield r)}}var yt=gt;u.UniqueTransducer=yt;var pt=function(e=f.ascending){return new gt(e)};u.unique=pt;var mt=function(e,t=1,r=!1){return new vt(e,t,r)};u.windowed=mt;class vt{constructor(e,t,r){this.size=e,this.step=t,this.remainder=r}async_(e){return o(this,arguments,(function*(){var t,r;let n=[],i=0;try{for(var o,a=c(e);!(o=yield s(a.next())).done;){const e=o.value;i>0?i--:(n.push(e),n.length===this.size&&(yield yield s([...n]),n=n.slice(this.step),this.step>this.size&&(i=this.step-this.size)))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=a.return)&&(yield s(r.call(a)))}finally{if(t)throw t.error}}this.remainder&&(yield yield s([...n]))}))}*sync(e){let t=[],r=0;for(const n of e)r>0?r--:(t.push(n),t.length===this.size&&(yield[...t],t=t.slice(this.step),this.step>this.size&&(r=this.step-this.size)));this.remainder&&(yield[...t])}}h=vt,u.WindowedTransducer=h;var wt=function(){var t=this,r={exports:this};function i(e){switch(typeof e){case"undefined":return!0;case"string":return""===e.trim();case"number":return isNaN(e);case"object":if(null==e)return!0;if(o.isObject(e))return 0===Object.keys(e).length;if(Array.isArray(e))return 0===e.length}return!1}t.__esModule=!0,t.isEmpty=i;t.Numbers=class{static parse(e){if(s.isEmpty(e))return;const t=Number(e);return isNaN(t)?void 0:t}};class s{static noWhitespace(e){return e&&"string"==typeof e?e.replace(/\s+/g,""):""}static startWith(e,t){return e?e.substring(0,t.length)===t:e===t}static endsWith(e,t){return e.substring(e.length-t.length,e.length)===t}static isEmpty(e){return void 0===e||(null===e||0===e.trim().length)}static isLowerCase(e){return e===e.toLowerCase()&&e!==e.toUpperCase()}static isUpperCase(e){return e===e.toUpperCase()&&e!==e.toLowerCase()}static kebabCase(e){return e.replace(/([A-Z][a-z]+|\d+)/gm,"-$1").replace(/^-/,"").toLowerCase()}static titleCase(e){return e.replace(/\w\S*/g,(e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()))}}t.Strings=s;class o{static isObject(e){return e&&"object"==typeof e&&(e.constructor===Object||/Object.*native/.test(e.constructor.toString()))}static keys(e){return Object.keys(e)}static values(e){return Object.keys(e).map((t=>e[t]))}static entries(e){return Object.keys(e).map((t=>[t,e[t]]))}static removeEmpty(e){return e&&o.isObject(e)?Object.keys(e).reduce(((t,r)=>{const n=o.removeEmpty(e[r]);return i(n)||(t[r]=n),t}),{}):e}static sort(e){return e?Array.isArray(e)?e.map(o.sort):o.isObject(e)?Object.keys(e).sort().reduce(((t,r)=>{const n=e[r];return t[r]=o.sort(n),t}),{}):e:e}static toLowerCase(e){return"string"==typeof e?e.toLowerCase():Array.isArray(e)?e.map(o.toLowerCase):c((()=>o.isObject(e)))?Object.entries(e).reduce(((e,[t,r])=>(e[t]=o.toLowerCase(r),e)),{}):e}static filter(e,t){const r=o.keys(e).filter(t);return o.pick(e,...r)}static omit(e,...t){return t.reduce(((e,t)=>(Reflect.deleteProperty(e,t),e)),e)}static pick(e,...t){return t.reduce(((t,r)=>(t[r]=e[r],t)),{})}}t.Objects=o;t.Maps=class{static entries(e){if(e.entries)return e.entries();const t=[];return e.forEach(((e,r)=>{t.push([r,e])})),t}};class a{static from(e){return Array.from(e)}static find(e,t){if(e.find)return e.find(t);const[r]=e.filter(t);return r}static toObject(e){return e.reduce(((e,t)=>(Object.keys(t).forEach((r=>{r in e||(e[r]=t[r])})),e)),{})}static flatten(e){return e.reduce(((e,t)=>e.concat(t)),[])}static flatMap(e,t){return e.flatMap?e.flatMap(t):a.flatten(e.map(t))}static unique(e){return Array.from(new Set(e))}static clean(e){return e.filter(Boolean)}static trim(e){return e.map((e=>e.trim()))}static includes(e,t){return"includes"in e?e.includes(t):-1!==e.indexOf(t)}static first(e){return e[0]}static last(e){return e[e.length-1]}static safeReverse(e){return e?e.slice().reverse():[]}}t.Arrays=a;function c(e,t){try{const r=e();return void 0===r?t:r}catch(e){return t}}function l(e,t){const r=t.toLowerCase(),n=a.find(Object.keys(e),(e=>e.toLowerCase()===r));if(!n)return;const i=e[n];return"string"==typeof i?i.trim():i}function d(e,...t){if(!e)return[];if(Array.isArray(e))return a.clean(a.flatten(e.map((e=>d(e,...t)))));if("object"==typeof e){const[r,...n]=t,i=l(e,r);return"object"==typeof i?d(i,...n):0===n.length&&Boolean(i)?[i]:[]}return[]}t.Elements=class{static path(e){let t=[e];for(;e.parentElement;)e=e.parentElement,t.push(e);return t}},t.get=c,t.getAsync=function(e,t){return n(this,void 0,void 0,(function*(){try{const r=yield e();return void 0===r?t:r}catch(e){return t}}))},t.getValue=l,t.getAll=d,t.extract=function(e,t){return a.flatten(t.map((t=>a.clean(a.unique(d(e,...t.split(".")))))))};const h="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:void 0!==r?r:Function("return this")();function g(e,t,r,n=(e=>e)){const i=[];let s,o=0;for(;null!=(s=e.exec(t));)i.push(n(t.substring(o,s.index))),i.push(r(s)),o=e.lastIndex;return i.push(n(t.substring(o))),i.join("")}function y(e){return e.substr(0,1).toUpperCase()+e.substr(1).toLowerCase()}t.globalThis=h,t.accumulateMultipleValues=function(e,t,r){const n=e[t];return void 0===n?e[t]=r:Array.isArray(n)?-1==n.indexOf(r)&&n.push(r):e[t]=[n,r],e},t.regexReplace=g,t.titleCase=function(e){return g(/\w+/g,e,(e=>y(e[0])))},t.caseWord=y,t.limit=function(e,t){return e.slice(0,t)};const p=/\s+/g;function m(e){return u.reduce(((t,r)=>{const[n,i]=e(r);return t[n]=i,t}),{})}function v(e){return e}return t.cleanSpaces=function(e){return e.trim().replace(p," ")},t.getClassName=function(e){return c((()=>a.last(e.constructor.name.split("$"))),"")},t.cleanText=function(e){return e?e.replace(/\s+/g," ").trim():""},t.zipObject=function(e,t){return f.single(e,u.zip(t),m(v))},t.toObject=m,t.identity=v,r.exports}.call({}),bt={};Object.defineProperty(bt,"__esModule",{value:!0});var kt=(St=void 0,bt.cache=St);bt.caching=kt;var Ot,xt,St=function(e,t,r){if("function"!=typeof r.value)throw new Error("@cache can only decorate methods");const n=new WeakMap;return Object.defineProperty(e,t,Object.assign(Object.assign({},r),{value:function(...e){const t=JSON.stringify(e),i=function(e){const t=n.get(e);if(t)return t;const r=new Map;return n.set(e,r),r}(this),s=i.get(t);if(void 0!==s)return s;if(i.has(t))return s;const o=r.value.call(this,...e);return i.set(t,o),o}}))};function It(e=wt.globalThis){return e.triptease=e.triptease||{},e.triptease.onboard=e.triptease.onboard||{},{triptease:e.triptease,onboard:e.triptease.onboard}}function At(e,t){return wt.get((()=>t.split(".").reduce(((e,t)=>e[t]),e)))}bt.cache=St,kt=function(e){const t=new Map;return function(...r){const n=JSON.stringify(r),i=t.get(n);if(void 0!==i)return i;if(t.has(n))return i;const s=e(...r);return t.set(n,s),s}},bt.caching=kt,(xt=Ot||(Ot={})).Native="native",xt.NonNative="non-native",xt.NotImplemented="not-implemented";class Et{static exposeApi(){const e=It(wt.globalThis).triptease;e.native||(e.native=Et)}static getProperty(e){const t=At(wt.globalThis,e);return(null==(r=t)?Ot.NotImplemented:"function"==typeof r?r.toString().includes("native code")?Ot.Native:Ot.NonNative:Ot.Native)!==Ot.NonNative?t:At(Et.window,e);var r}static get window(){const e=wt.globalThis;if(!e.document)return e;try{const t=e.document,r=t.querySelector("[name='triptease.native']");if(r)return r.contentWindow;const n=t.createElement("iframe");return n.style.display="none",n.setAttribute("title","blank"),n.setAttribute("aria-hidden","true"),n.setAttribute("name","triptease.native"),t.documentElement.appendChild(n),n.contentWindow}catch(t){return e}}}t([bt.cache,r("design:type",Function),r("design:paramtypes",[String]),r("design:returntype",Object)],Et,"getProperty",null),t([X.lazy,r("design:type",Object),r("design:paramtypes",[])],Et,"window",null);const Ct=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}\.\d{3}Z)?$/;function Pt(e,t,r){if(t(e))return r(e);switch(typeof e){case"undefined":return;case"object":if(null===e)return null;if(Array.isArray(e))return e.map((e=>Pt(e,t,r)));if(wt.Objects.isObject(e))return wt.Objects.keys(e).sort().reduce(((n,i)=>{const s=e[i];return n[i]=Pt(s,t,r),n}),{})}return e}const Ht=Et.getProperty("JSON.parse"),jt=Et.getProperty("JSON.stringify");class Tt{static parse(e){return Ht(e)}static parseWithDates(e){return function(e){return Pt(e,(e=>"string"==typeof e&&Ct.test(e)),(e=>{const t=new Date(e);return isNaN(t.valueOf())?e:t}))}(Tt.parse(e))}static stringify(e){return jt(this.validate(e))}static validate(e){return Pt(e,(e=>{const t=typeof e;switch(t){case"undefined":case"string":case"number":case"boolean":return!0;case"object":if(null===e)return!0;if(Array.isArray(e))return!1;if(wt.Objects.isObject(e))return!1;if("toJSON"in e)return!0}throw new Error(`Illegal JsonValue: ${t} ${e} `)}),(e=>e))}}class Lt{static same(e,t){return Tt.stringify(e)===Tt.stringify(t)}static isSuperset(e,t){return null===e||null===t?Lt.same(e,t):Array.isArray(e)&&Array.isArray(t)?!(e.length>t.length)&&e.every((e=>t.some((t=>Lt.isSuperset(e,t))))):wt.get((()=>wt.Objects.isObject(e)))&&wt.get((()=>wt.Objects.isObject(t)))?Object.keys(e).reduce(((r,n)=>r&&Lt.isSuperset(e[n],t[n])),!0):Lt.same(e,t)}static compress(e){const t=Lt.groupValues(e);return this.compressGrouped(t)}static compressGrouped(e){return Object.entries(e).reduce((({shared:e,unique:t},[r,n])=>{if(wt.get((()=>wt.Objects.isObject(n)))){const i=Lt.compressGrouped(n);Object.keys(i.shared).length>0&&(e[r]=i.shared),i.unique.forEach(((e,n)=>{t[n]=t[n]||{},Object.keys(e).length>0&&(t[n][r]=e)}))}return Array.isArray(n)&&n.forEach(((i,s)=>{t[s]=t[s]||{},1===wt.Arrays.unique(n.map((e=>Tt.stringify(e)))).length?e[r]=i:void 0!==i&&(t[s][r]=i)})),{shared:e,unique:t}}),{shared:{},unique:[]})}static groupValues(e){const t=Array.from(e.reduce(((e,t)=>Object.keys(t).reduce(((e,t)=>e.add(t)),e)),new Set)),[r,n]=e.reduce(((e,r)=>t.reduce((([e,t],n)=>{const i=r[n];return wt.get((()=>wt.Objects.isObject(i)))?(t[n]=t[n]||[],t[n].push(i)):(e[n]=e[n]||[],e[n].push(i)),[e,t]}),e)),[{},{}]),i=Object.entries(n).reduce(((e,[t,r])=>(e[t]=Lt.groupValues(r),e)),{});return Object.assign(Object.assign({},r),i)}static decompress(e){return e.unique.map((t=>this.merge(e.shared,t)))}static merge(e,t){return[...Object.keys(e),...Object.keys(t)].reduce(((r,n)=>{const i=e[n],s=t[n];return wt.get((()=>wt.Objects.isObject(i)))&&wt.get((()=>wt.Objects.isObject(s)))?r[n]=Lt.merge(i,s):r[n]=null!=s?s:i,r}),{})}}function qt(e,t=!0){return e?(0==e.indexOf("?")&&(e=e.substring(1,e.length)),e.split("&").map((function(e){return e.split("=")})).reduce((function(e,r){const n=r[0],i=r[1];if(!n)return e;const s=i?wt.get((()=>decodeURIComponent(i.replace(/\+/g,"%20"))),void 0):i,o=t?function(e){try{return Tt.parse(e)}catch(t){return e}}(s):s;return wt.accumulateMultipleValues(e,n,o)}),{})):{}}function Rt(e,t=!0){return Object.keys(wt.Objects.removeEmpty(e)).map((r=>{const n=e[r],i=t?function(e){return"string"==typeof e?e:JSON.stringify(e)}(n):n;return`${r}=${encodeURIComponent(i)}`})).join("&")}const Bt=Et.getProperty("console.log"),Mt=Et.getProperty("console.error"),_t=Et.getProperty("console.debug");class Nt{constructor(e=Bt,t=Mt,r=_t||Bt){this.log=e,this.error=t,this.debug=r}}class zt{constructor(){this.log=()=>{},this.error=()=>{},this.debug=()=>{}}}const Dt="triptease-debug";function Wt(e,t="triptease-debug"){const r=wt.get((()=>{var r;return qt(null===(r=e.location)||void 0===r?void 0:r.search,!1)[t]}))||wt.get((()=>{var r;return qt(new l(null===(r=e.location)||void 0===r?void 0:r.originalHref).query,!1)[t]}))||wt.get((()=>{var t,r;return null===(r=null===(t=e.process)||void 0===t?void 0:t.env)||void 0===r?void 0:r.DEBUG}))||wt.get((()=>{var r;return(null===(r=e.localStorage)||void 0===r?void 0:r.getItem)&&e.localStorage.getItem(t)}))||wt.get((()=>{var r;return(null===(r=e.sessionStorage)||void 0===r?void 0:r.getItem)&&e.sessionStorage.getItem(t)}))||"";return wt.get((()=>r.substring(0,256)),"")}function Ft(e){const t=e.replace(/\./g,"\\.").replace(/\*/g,".*");return new RegExp("^"+t+"$")}function $t(e,t=wt.globalThis){try{const r=function(e){return Wt(e,Dt).split(",").map((e=>e.trim()))}(t),n=r.filter((e=>"!"===e[0])).map((e=>e.substr(1)));return n.length>0?!n.some((t=>Ft(t).test(e))):r.some((t=>"true"===t||Ft(t).test(e)))}catch(e){return!1}}class Gt{constructor(e){this.name=e,this.console=new Nt}debug(e,...t){this.console.debug(`[${this.name}] ${e}`,...t)}log(e,...t){this.console.log(`[${this.name}] ${e}`,...t)}error(e,...t){this.console.error(`[${this.name}] ${e}`,...t)}}function Ut(e,t=wt.globalThis){return $t(e,t)?new Gt(e):new zt}class Vt{constructor(e,t){this.name=e,this.trackingApi=t,this.logger=Ut(e)}debug(e,...t){this.logger.debug(e,...t)}error(e,...t){this.logger.error(e,...t);try{this.trackingApi.trackError({name:this.name,message:e,args:t.map((e=>{return Yt(e)?{name:(t=e).name,message:t.message,stack:t.stack}:e;var t}))})}catch(e){this.logger.error("Failed to track error",e)}}log(e,...t){this.logger.log(e,...t)}}class Kt{constructor(e,t,r=Zt,n=Ut("messaging")){this.listener=e,this.target=t,this.allowedOrigins=r,this.logger=n}addListener(e){this.listener&&this.listener.addEventListener("message",(t=>{this.disallowedOrigin(t)||function(e){try{const{target:t,method:r}=Xt(e.type);if(t&&r)return!0}catch(e){}return!1}(t.data)&&e(t.data,new Kt(void 0,t.source||this.target))}))}disallowedOrigin(e){return e.origin&&this.allowedOrigins.length>0&&-1===this.allowedOrigins.indexOf(new l(e.origin).host)}send(e){if(this.target)try{this.target.postMessage(e,"*")}catch(t){this.target.postMessage(JSON.parse(JSON.stringify(e)),"*")}}}const Zt=["onboard.triptease.io","localhost"],Jt=/^(.*)\.([^.]+)$/;function Xt(e){const[,t,r]=e.match(Jt)||[];return{target:t,method:r}}function Qt(e){const t={};return function(...r){const n=JSON.stringify(r),i=t[n];return void 0!==i?i:t[n]=e(...r)}}function Yt(e){return e&&"object"==typeof e&&"name"in e&&"string"==typeof e.name&&"message"in e&&"string"==typeof e.message&&"stack"in e&&"string"==typeof e.stack}function er(e,t,r){return{name:e,message:t,stack:null!=r?r:""}}new Set(["Unknown","PossibleIdentifier"]),new Set(["HotelName","HotelCode","ChainCode"]);var tr,rr,nr,ir;(rr=tr||(tr={})).Search="Search",rr.RoomsAndRates="RoomsAndRates",rr.Confirmation="Confirmation",rr.Payment="Payment",rr.Group="Group",rr.Partial="Partial",rr.Unknown="Unknown",(ir=nr||(nr={})).Singleton="Singleton",ir.ApplicationHost="ApplicationHost",ir.DataSource="DataSource";class sr{static get(){return wt.get((()=>{const e="4670.46316";return"v"+e}),"latest")}}var or,ar,cr={};function lr(e){return e&&"object"==typeof e&&"string"==typeof e.name&&"string"==typeof e.type&&"string"==typeof e.url}function dr(e,t={credentials:!1}){return n(this,void 0,void 0,(function*(){if("undefined"!=typeof fetch){const r=yield fetch(e.url,{method:e.method,headers:e.headers,body:e.body,credentials:t.credentials?"include":"omit"});return{status:r.status,statusDescription:r.statusText,body:yield r.text()}}{const r=new XMLHttpRequest;return r.open(e.method,e.url,!0),e.headers&&Object.keys(e.headers).forEach((t=>{r.setRequestHeader(t,e.headers[t])})),r.withCredentials=t.credentials,r.send(e.body),new Promise(((e,t)=>{r.addEventListener("load",(t=>{e({status:r.status,statusDescription:r.statusText,body:r.responseText})})),r.addEventListener("error",(e=>{t(e)}))}))}}))}cr.isClientSideApplication=lr;class ur{constructor(e){this.logger=e,this.workers={}}createWorker(e,t){return n(this,void 0,void 0,(function*(){const r=this.workers[e];return r||(this.workers[e]=yield this.create(t,{name:e}))}))}create(e,t){return n(this,void 0,void 0,(function*(){try{return new Worker(e,t)}catch(r){this.logger.debug("Failed to create Worker switching to Blob Worker because:",r.message);const n=`location.originalHref = "${e}";\n`,i=(yield dr({method:"GET",url:e})).body,s=new Blob([n,i],{type:"application/javascript"});return new Worker(URL.createObjectURL(s),t)}}))}}class hr{constructor(e,t=Ut("application-starter"),r=new ur(t),n=new fr(e,t)){this.window=e,this.logging=t,this.workerFactory=r,this.waiter=n}start(e){return n(this,void 0,void 0,(function*(){this.logging.debug(`ApplicationStarter starting app "${e.name}" (${e.type}), ${e.url}`);const t=this.window.document;if("worker"===e.type){const t=yield this.workerFactory.createWorker(e.name,e.url);return e.startMessage&&(yield this.waiter.waitForMessage(e.startMessage,t)),this.logging.debug("ApplicationStarter returning worker"),t}const r=t.createElement(e.type);r.setAttribute("name",e.name),r.src=e.url;const n=hr.DefaultOptions[e.type]||{};return Object.keys(n).forEach((e=>{r.setAttribute(e.toLowerCase(),n[e])})),this.addElement(r),e.startMessage?yield this.waiter.waitForMessage(e.startMessage):"script"===e.type&&(yield this.waiter.waitForLoadEvent(r)),r}))}addElement(e){(this.window.document.body||this.window.document.documentElement).appendChild(e)}static create(e){var t;const r=It(e).triptease.onboard;return r.applicationStarter=null!==(t=r.applicationStarter)&&void 0!==t?t:new hr(e)}}hr.DefaultOptions={script:{defer:"",async:"",crossOrigin:"anonymous"},iframe:{style:"display: none;",sandbox:"allow-scripts allow-same-origin",title:"blank","aria-hidden":"true"}},t([bt.cache,r("design:type",Function),r("design:paramtypes",["function"==typeof(or=void 0!==cr&&cr.ClientSideApplication)?or:Object]),r("design:returntype","function"==typeof(ar="undefined"!=typeof Promise&&Promise)?ar:Object)],hr.prototype,"start",null);class fr{constructor(e,t){this.window=e,this.logging=t}waitForLoadEvent(e){return this.logging.debug("MessageWaiter waiting for load/error event for",e),new Promise(((t,r)=>{e.addEventListener("load",t),e.addEventListener("error",(()=>r({name:"ScriptError",message:`Failed to load script "${e.src}"`})))}))}waitForMessage(e,t=this.window){return this.logging.debug("MessageWaiter waiting for message",e),new Promise((r=>{this.logging.debug("MessageWaiter creating handler");const n=i=>{try{const s=i.data&&i.data.type,o=s===e;this.logging.debug(`ApplicationStarter message received "${s}", expecting "${e}", matched: ${o}`),o&&(t.removeEventListener("message",n),r(i.data))}catch(e){this.logging.debug("ApplicationStarter error in parsing message",e,i)}};this.logging.debug("MessageWaiter adding listener"),t.addEventListener("message",n)}))}}var gr={};Object.defineProperty(gr,"__esModule",{value:!0});var yr=(pr=void 0,gr.SystemClock=pr);gr.StoppedClock=yr;var pr=class{now(){return new Date}};gr.SystemClock=pr;yr=class{constructor(e){this.value=e}now(){return this.value}},gr.StoppedClock=yr;class mr{generate(e){return Sr(e)()}}function vr(e){const t=new Error(e);return t.source="ulid",t}const wr="0123456789ABCDEFGHJKMNPQRSTVWXYZ",br=wr.length,kr=Math.pow(2,48)-1;function Or(e){let t=Math.floor(e()*br);return t===br&&(t=br-1),wr.charAt(t)}const xr=wt.globalThis;function Sr(e=26,t=new gr.SystemClock,r=function(e=xr.crypto){return()=>{try{const t=new Uint8Array(1);return e.getRandomValues(t),t[0]/255}catch(e){return Math.random()}}}()){return function(n){return(void 0===n||isNaN(n))&&(n=t.now().getTime()),function(e,t){if(isNaN(e))throw new Error(e+" must be a number");if(e>kr)throw vr("cannot encode time greater than "+kr);if(e<0)throw vr("time must be positive");if(!Number.isInteger(e))throw vr("time must be an integer");let r,n="";for(;t>0;t--)r=e%br,n=wr.charAt(r)+n,e=(e-r)/br;return n}(n,10)+function(e,t){let r="";for(;e>0;e--)r=Or(t)+r;return r}(function(e){if(e<10)throw new Error("Length must be at least 10 characters");return e-10}(e),r)}}const Ir=Sr();class Ar{constructor(e,t=new gr.SystemClock,r=dr){this.window=e,this.clock=t,this.httpClient=r,this.domainUserIdName="tt-domain-user-id"}getIdentity(){return n(this,void 0,void 0,(function*(){const e=yield this.httpClient({url:"https://api.triptease.io/identity-service/identity",method:"GET"},{credentials:!0});return Object.assign(Object.assign({},Tt.parse(e.body)),{domainUserId:this.getDomainId()})}))}getDomainId(){try{const e=this.window.localStorage.getItem(this.domainUserIdName);if(e)return e}catch(e){}const e=Ir();try{this.window.localStorage.setItem(this.domainUserIdName,e)}catch(e){}return e}}function Er(e,t){for(t=e="";e++<36;t+=51*e&52?(15^e?8^Math.random()*(20^e?16:4):4).toString(16):"-");return t}class Cr{generate(e){if(void 0!==e)throw new Error("UuidGenerator does not support custom lengths");return Er().replace(/-/g,"")}}class Pr{constructor(e,t){this.messaging=e,this.idGenerator=t}get(e,t,r){return(...e)=>n(this,void 0,void 0,(function*(){const r=this.idGenerator.generate(),{payload:n}=yield this.messaging.handle({type:"triptease.onboard.request",requestType:String(t),payload:e,correlationId:r});if(Yt(n))throw n;return n}))}}function Hr(e,t=new Cr){return new Proxy({},new Pr(e,t))}class jr{constructor(e,t=Hr(e)){this.proxy=t,this.applicationConfig=Qt((e=>n(this,void 0,void 0,(function*(){return yield this.proxy.applicationConfig(e)})))),this.generateConfig=Qt((e=>n(this,void 0,void 0,(function*(){return yield this.proxy.generateConfig(e)}))))}}class Tr{constructor(){this.scripts=[]}static create(e){const t=It(e).onboard,r=t.stackScriptFinder;return r||(t.stackScriptFinder=new Tr)}capture(){const e=function(){try{throw new Error}catch(e){if(!e.stack)return;const t=e.stack.match(Lr);if(!t)return;const r=t[1];return new l(r)}}();e&&this.scripts.push(e)}get(){return this.scripts}}const Lr=/(https?.*):\d+:\d+/;const qr=Et.getProperty("Date");class Rr{now(){return new qr}}class Br{now(){return new Date}}const Mr={name:"onboard",version:sr.get()};class _r{constructor(e,t,r=Ut("analytics"),i=50){this.window=e,this.clock=t,this.logger=r,this.batchSize=i,this.queued=[],setInterval((()=>n(this,void 0,void 0,(function*(){return yield this.flush()}))),1e3),this.window.addEventListener("unload",(()=>n(this,void 0,void 0,(function*(){return yield this.flush()}))))}send(e){return n(this,void 0,void 0,(function*(){this.queued.push(function(e,t){return Object.assign({messageId:Er(),createdAt:e.now()},t)}(this.clock,e)),this.queued.length>this.batchSize&&(yield this.flush())}))}flush(){return n(this,void 0,void 0,(function*(){if(0===this.queued.length)return;const e=this.queued.splice(0,this.batchSize);this.logger.log(`Flushing batch of ${e.length}, remaining in queue ${this.queued.length}`);!function({method:e="POST",url:t,body:r}){const n=JSON.stringify(r);if(void 0!==navigator.sendBeacon&&"POST"===e)navigator.sendBeacon(t,n);else if("undefined"!=typeof fetch)fetch(t,{method:e,body:n});else if(XMLHttpRequest){const r=new XMLHttpRequest;r.open(e,t,!0),r.send(n)}}({url:"https://onboard.triptease.io/message/batch",body:{type:"triptease.onboard.batch",sentAt:this.clock.now(),payload:e}})}))}}function Nr(e){return{title:e.document.title,locale:e.document.documentElement.lang||e.document.documentElement.getAttribute("xml:lang")||"",url:e.location.href,urlParsed:zr(e.location.href),referrer:e.document.referrer,referrerParsed:zr(e.document.referrer),characterSet:e.document.characterSet,opener:wt.get((()=>Boolean(e.opener)),!1)}}function zr(e){if(!e)return{};const{scheme:t,host:r,path:n,query:i,fragment:s}=new l(e);return wt.Objects.removeEmpty({scheme:t,host:r,path:n,query:i,queryParsed:qt(i,!1),fragment:s})}class Dr{constructor(e,t=new Br){this.window=e,this.clock=t;try{this.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){this.timezone=""}}buildMessage(e){return n(this,void 0,void 0,(function*(){const t=wt.get((()=>this.window.triptease.onboard.bootstrap.identity),{}),r=this.clock.now();return Lt.merge({createdAt:r,messageId:Er(),anonymousId:wt.get((()=>t.anonymousId)),userId:wt.get((()=>t.userId)),sessionId:wt.get((()=>t.sessionId)),domainUserId:wt.get((()=>t.domainUserId)),context:{library:Mr,userAgent:this.window.navigator.userAgent,locale:this.window.navigator.language,page:Nr(this.window),screen:{width:this.window.screen.width,height:this.window.screen.height},timezone:this.timezone}},e)}))}}const Wr="triptease.onboard.response";function Fr(e){return e&&"object"==typeof e&&"triptease.onboard.request"===e.type&&"string"==typeof e.requestType&&"string"==typeof e.correlationId&&Array.isArray(e.payload)}function $r(e){return e&&"object"==typeof e&&"triptease.onboard.response"===e.type&&"string"==typeof e.correlationId}function Gr(e,t){return{type:"triptease.onboard.response",correlationId:e,payload:t}}function Ur(e,t){return Gr(e,er("NotFound","No handler found for "+t))}const Vr=Ut("messaging");class Kr{constructor(){this.handlers=new Map}register(e,t){return e.forEach((e=>{if(this.hasHandlerFor(e))throw new Error(`Method name "${e}" already registered to a handler`);this.handlers.set(e,t)})),this}handle(e){return n(this,void 0,void 0,(function*(){const t=this.handlers.get(e.requestType);return t?(Vr.debug("Matched message to handler",e,t),yield t.handle(e)):Ur(e.correlationId,e.requestType)}))}hasHandlerFor(e){return this.handlers.has(e)}}const Zr=Ut("messaging");class Jr{constructor(e){this.target=e}handle(e){return n(this,void 0,void 0,(function*(){const t=this.target[e.requestType];if(!t)return Zr.debug("No method found that matches method",e.requestType,this.target),Ur(e.correlationId,e.requestType);try{Zr.debug("Found method",e.requestType);const r=yield t.apply(this.target,e.payload);return Gr(e.correlationId,r)}catch(t){return Zr.debug("Error trying to in invoke method",e.requestType,t),function(e,t){return Gr(e,er(t.name,t.message,t.stack))}(e.correlationId,t)}}))}}const Xr=sr.get();function Qr(e){return e.replace(/-/g,"").toLowerCase()}class Yr{constructor(e){if(this.name=e,!/[A-Za-z0-9]/.test(e))throw new Error("Only alpha numeric allowed");Yr.Lookup.set(Qr(e),this)}static values(){return Array.from(Yr.Lookup.values())}static parse(e){const t=Yr.Lookup.get(Qr(e));if(!t)throw new Error("Invalid booking engine name");return t}toString(){return this.name}get canonical(){return Qr(this.name)}get folder(){return this.isSelfIntegration()?Yr.Default.folder:wt.Strings.kebabCase(this.name)}get script(){return this.isClientIntegration()?`https://integration.triptease.io/client-integrations/platform/${this.folder}.js`:function(e){return`https://onboard.triptease.io/integrations/${Xr}/${e}.js`}(this.folder)}isClientIntegration(){return Yr.ClientIntegration.has(this)}isSelfIntegration(){return Yr.SelfIntegration.has(this)}}function en(e,...t){const r=wt.getAll(e,...t);if(!r)return;const[n]=[...r].reverse();return n}function tn(e){const t=wt.get((()=>function(e){const t=e.hostname.toLowerCase(),r=e.href.toLowerCase(),n=e.pathname.toLowerCase();return"gc.synxis.com"===t||"be.synxis.com"===t?Yr.Synxis:-1!==t.indexOf("travelclick")?Yr.TravelClick:-1!==t.indexOf("bookingbutton")||-1!==t.indexOf("book-directonline")||-1!==t.indexOf("direct-book.com")?Yr.SiteMinder:-1!==t.indexOf(".hyatt.")?Yr.Hyatt:-1!==t.indexOf(".bookonthenet.")?Yr.RoomKey:-1!==t.indexOf("firmdalehotels")?Yr.Firmdale:-1!==t.indexOf("apxhotelsapartments")||-1!==t.indexOf("mews.li")?Yr.Mews:-1!==t.indexOf("guestline.net")||-1!==t.indexOf("roomlynx.net")?Yr.GuestLine:-1!==t.indexOf("book-onlinenow.net")?Yr.BookOnlineNow:-1!==t.indexOf("windsurfercrs.com")?Yr.Shr:-1!==t.indexOf("bestwestern.fr")?Yr.BestWesternFrance:-1!==t.indexOf("walkerhill.com")?Yr.WalkerHill:-1!==r.indexOf("webrez.com")||-1!==t.indexOf("worldweb.com")||-1!==t.indexOf("webrez.com/v")?Yr.WebRezPro:-1!==t.indexOf("hoteliers.com")?Yr.Hoteliers:-1!==t.indexOf("doylecollection")?Yr.DoyleCollection:-1!==r.indexOf("/bookcore/")?Yr.Roiback:-1!==t.indexOf("nativeplaces.com")?Yr.NativePlaces:-1!==r.indexOf("/cgi-bin/lansaweb")||"www.palms.com"===t?Yr.StationCasinos:-1!==t.indexOf(".webhotel.")?Yr.Opera:-1!==t.indexOf("constancehotels.com")?Yr.ConstanceHotels:-1!==t.indexOf("online.bookvisit.")?Yr.BookVisit:-1!==t.indexOf("direct-reservation")?Yr.BusyRooms:-1!==t.indexOf("youngshotels")?Yr.Youngs:"reservations.thekingsburyhotel.com"===t||"bookings.amayaresorts.com"===t?Yr.Hayleys:-1!==t.indexOf("www.secure-res.com")?Yr.Vizergy:-1!==t.indexOf("loewshotels")?Yr.Loews:-1!==r.indexOf("bookings.hamiltonisland.com.au/")?Yr.HamiltonIsland:-1!==t.indexOf("regalhotel")?Yr.RegalHotels:-1!==t.indexOf("live.high-level-software")?Yr.HighLevelSoftware:-1!==t.indexOf("premiereserve.com")||-1!==t.indexOf("teg-hotels.com")?Yr.Everly:-1!==t.indexOf("simplebooking")||-1!==t.indexOf("booking.crimsonhotel")?Yr.SimpleBooking:-1!==t.indexOf("bookassist.com")?Yr.BookAssist:-1!==t.indexOf("booking.africaalbidatourism.com")?Yr.AfricaAlbida:-1!==t.indexOf("pphotels.com")||-1!==t.indexOf("erez.mmcmg.net")?Yr.PrimePlaza:-1!==t.indexOf("onepagebooking.com")?Yr.HotelNetSolutions:-1!==t.indexOf("reservhotel.com")?Yr.ReserveHotel:-1!==r.indexOf("/irmng")?Yr.IRM:-1!==t.indexOf("booking-channel.com")?Yr.Hotusa:t.includes(".venetian.")||t.includes(".venetianlasvegas.")?Yr.SandsVegas:-1!==t.indexOf("clock-software.com")||-1!==t.indexOf("villasriomar.com")?Yr.Clock:-1!==t.indexOf("tajinnercircle.com")||-1!==t.indexOf("tajhotels.com")?Yr.Taj:-1!==t.indexOf("booking.iberostartheclub.com")?Yr.Iberostar:-1!==t.indexOf("services.comwell.com")?Yr.Comwell:-1!==t.indexOf("elinapms.com")?Yr.Elina:-1!==t.indexOf(".profitroom.")?Yr.ProfitRoom:-1!==t.indexOf("bookingexpert.it")?Yr.BookingExpert:-1!==t.indexOf("cloud-reservations.net")?Yr.Hart:-1!==t.indexOf("irm1.net")||0===n.indexOf("/irmnet/")?Yr.RDP:-1!==t.indexOf("pr.palaceresorts.com")||-1!==t.indexOf("pr.moonpalace.com")||-1!==t.indexOf("pr.leblancsparesorts.com")?Yr.PalaceResorts:-1!==t.indexOf(".palaceresorts.com")||-1!==t.indexOf(".moonpalace.com")||-1!==t.indexOf(".leblancsparesorts.com")||-1!==t.indexOf(".beachviewbarbados.com")||-1!==t.indexOf(".oceantwobarbados.com")||-1!==t.indexOf(".sea-breeze.com")||-1!==t.indexOf(".southbeachbarbados.com")?Yr.Kognitiv:-1!==t.indexOf(".iqwebbook.com")?Yr.InnQuest:-1!==t.indexOf("theguild.co")?Yr.Guild:-1!==t.indexOf(".innroad.com")?Yr.InnRoad:-1!==t.indexOf(".furama.com")?Yr.Furama:-1!==t.indexOf(".reztrip.com")?Yr.Reztrip:-1!==t.indexOf("nisekoportfolio.com")?Yr.BookEasy:-1!==t.indexOf("azimuthotels")&&-1===t.indexOf("reservations")?Yr.Azimut:-1!==t.indexOf(".steigenberger.com")||-1!==t.indexOf(".intercityhotel.com")||-1!==t.indexOf(".maxxhotel.com")||-1!==t.indexOf(".jaz-hotel.com")?Yr.DeutscheHospitality:-1!==t.indexOf(".cloudbeds.com")?Yr.CloudBeds:-1!==t.indexOf("coasthotels.com")?Yr.Amadeus:-1!==t.indexOf(".thehoxton.com")?Yr.Hoxton:-1!==t.indexOf(".lottehotel.com")?Yr.Lotte:-1!==t.indexOf("kempinski.com")?Yr.Kempinski:-1!==t.indexOf("derquebooking")||-1!==t.indexOf(".gfhoteles.")?Yr.DerqueBooking:-1!==t.indexOf("ovolohotels.com")?Yr.Ovolo:-1!==t.indexOf(".gleneagles.com")?Yr.GlenEagles:-1!==t.indexOf(".redplanethotels.com")?Yr.RedPlanet:-1!==t.indexOf(".banffjaspercollection.com")||-1!==t.indexOf(".glacierparkcollection.com")?Yr.PursuitCollection:-1!==t.indexOf(".bestwestern.co.uk")?Yr.BestWesternUk:-1!==t.indexOf(".sbe.com")?Yr.Sbe:-1!==t.indexOf(".bode.co")?Yr.Bode:-1!==t.indexOf(".reserve-online.net")?Yr.ReserveOnline:-1!==t.indexOf("secure-hotel-booking.com")?Yr.AvailPro:-1!==t.indexOf(".syshotelonline.it")?Yr.SysHotelOnline:-1!==t.indexOf(".reservit.com")?Yr.Reservit:-1!==t.indexOf(".vinpearl.com")?Yr.Vinpearl:-1!==t.indexOf(".omnibees.com")?Yr.Omnibees:-1!==t.indexOf(".hipotels.com")?Yr.Hipotels:-1!==t.indexOf(".handpickedhotels.co.uk")?Yr.HandPickedHotels:-1!==t.indexOf("bookings.zafirohotels.com")?Yr.Zafiro:-1!==t.indexOf(".viatocrs.de")?Yr.Viato:-1!==t.indexOf(".easy-booking.")?Yr.EasyBooking:-1!==t.indexOf(".ipms247.")||-1!==t.indexOf("reservas.hotelkokai.com")?Yr.Ezee:-1!==t.indexOf(".innstyle.")?Yr.InnStyle:-1!==t.indexOf(".book-secure.")?Yr.FastBooking:-1!==t.indexOf(".cityexpress.")?Yr.CityExpress:-1!==t.indexOf(".hoteleasyreservations.")?Yr.EasyConsulting:-1!==t.indexOf(".travelanium.")?Yr.Travelanium:-1!==t.indexOf(".e-gds.")?Yr.EGds:-1!==t.indexOf(".booking.com")?Yr.Booking:-1!==t.indexOf(".iperbooking.")?Yr.Iperbooking:-1!==t.indexOf(".okuhotels.")?Yr.OKU:-1!==t.indexOf(".pegsbe.")?Yr.Pegasus:-1!==t.indexOf(".the-ascott.")||-1!==t.indexOf(".discoverasr.")?Yr.Ascott:-1!==t.indexOf("kasa.")?Yr.Kasa:-1!==t.indexOf("aubergeresorts.")?Yr.Auberge:-1!==t.indexOf("verticalbooking.")?Yr.VerticalBooking:-1!==t.indexOf(".avvio.")?Yr.Avvio:-1!==t.indexOf(".bestwestern.it")?Yr.BestWesternItaly:-1!==t.indexOf("bookings.claytonhotel")?Yr.ClaytonHotel:-1!==t.indexOf("extendedstayamerica.")?Yr.ExtendedStayAmerica:-1!==t.indexOf(".fourseasons.")||-1!==t.indexOf(".fourseasonscountryclub.")?Yr.FourSeasons:-1!==t.indexOf(".hti-systems.")?Yr.HtiSystems:-1!==t.indexOf("lhw.")?Yr.LHW:-1!==t.indexOf("nh-hotels.")||-1!==t.indexOf(".nh-hoteles.")?Yr.NHHotels:-1!==t.indexOf("nh-collection.")?Yr.NHCollection:-1!==t.indexOf(".h-hotels.")?Yr.HHotels:-1!==t.indexOf(".gothiatowers.")||-1!==t.indexOf(".upperhouse.")?Yr.GothiaTowers:-1!==t.indexOf(".1hotels.")?Yr.OneHotels:void 0}(e.location)));if(t)return t;const r=wt.get((()=>function(e){if(e.document.querySelector('link[href*="be.synxis.com"]'))return Yr.Synxis;if(wt.get((()=>Object.keys(e._GlobalTokens).length),0))return Boolean(e.document.querySelector("#XbeViewPanel")),Yr.Synxis;return wt.get((()=>-1!==e.process.env.APPLICATION_URL.indexOf("be.synxis.com")),!1)?Yr.Synxis:wt.get((()=>-1!==e.apiUrl.indexOf("travelclick")),!1)||wt.get((()=>!!en(e.dataLayer,"ihHotelID")),!1)||wt.get((()=>!!wt.Arrays.find(wt.Arrays.from(e.document.querySelectorAll('script[type="text/javascript"]')).map((e=>e.textContent)),(e=>-1!==e.indexOf("travelclick")))),!1)?Yr.TravelClick:wt.get((()=>e.document.querySelector('link[href*="vendors~about~booking~cancellation~checkout~confirmation~contact~policies~reservation"]')))||wt.get((()=>"Modern"===en(e.dataLayer,"booking_engine")))||wt.get((()=>en(e.dataLayer,"tbb_prefix")))||wt.get((()=>en(e.dataLayer,"virtual_url")))||wt.get((()=>e.document.querySelector('meta[name="occupancy-includes-infants"]')))||wt.get((()=>!!e.digitalPartner.triptease))?Yr.SiteMinder:wt.get((()=>e.dataLayer.some((e=>e.neobookings))),!1)?Yr.NeoBookings:wt.get((()=>"smart"===en(e.dataLayer,"context.application")),!1)?Yr.AvailPro:e.document.querySelector('iframe.mews-distributor, script[src*="mews.li"]')?Yr.Mews:wt.get((()=>Boolean(e.WSMAIN)),!1)?Yr.Shr:wt.get((()=>e.document.querySelector("#clienId")),void 0)?Yr.RMSCloud:null!==e.document.querySelector("body#ElinaPBE")?Yr.Elina:null!==e.document.getElementById("bookingGadget")?Yr.GuestCentric:Boolean(e.document.querySelector('script[src*="UiBSJs"]'))?Yr.Uibscrs:wt.get((()=>Boolean(e.Mirai)),!1)?Yr.Mirai:"paraty"===e.MAIN_SITE?Yr.Paraty:e.document.querySelector('[href^="https://www.booking2hotels.com"]')||e.document.querySelector('.booking-engine img[src*="booking2hotels"]')?Yr.Booking2Hotels:e.document.querySelector('script[src*="seekda"]')?Yr.Seekda:e.document.querySelector('meta[name="author"][content*="alaric"]')?Yr.Alaric:wt.get((()=>-1!==e.top.location.hostname.toLowerCase().indexOf("hotel-llevant")),!1)?Yr.Prestige:wt.get((()=>-1!==e.document.querySelector('meta[name="description"]').content.indexOf("reztrip")),!1)?Yr.Reztrip:wt.get((()=>!!e.PROTELWBE5),!1)?Yr.Protel:wt.get((()=>e.document.querySelector('link[href*="/bookvisit/"]')))?Yr.BookVisit:wt.get((()=>e.document.querySelector('link[href*="webhotelier.net"]')))?Yr.ReserveOnline:wt.get((()=>e.document.querySelector("#availpro-tracker")))?Yr.AvailPro:wt.get((()=>e.document.querySelector("meta[name=Author][content*=RESERVIT]")))?Yr.Reservit:wt.get((()=>e.document.querySelector("#eZee_BookingContainer, #eZee_BookingHeader, #eZee_BookingFilter, #eZ_BookingRooms")))?Yr.Ezee:wt.get((()=>e.document.querySelector("img[src*=hotetec],a[href*=hotetec]")))?Yr.Hotetec:wt.get((()=>e.document.querySelector("link[href*=cityexpress]")))?Yr.CityExpress:wt.get((()=>e.document.querySelector("link[href*=travelanium]")))?Yr.Travelanium:wt.get((()=>e.document.querySelector('a[href*=".e-gds."],img[src*=".e-gds."]')))?Yr.EGds:wt.get((()=>e.document.querySelector('img[src*=".pegsbe."],img[src*=".bookingdirect."]')))?Yr.Pegasus:wt.get((()=>e.document.querySelector("a[href*=verticalbooking], a[href*=VerticalBooking], script[src*=verticalbooking]")))?Yr.VerticalBooking:wt.get((()=>e.document.querySelector("guestdesk")))?Yr.GuestDesk:e.document.querySelector("img[src*=booking-channel],div[style*=booking-channel]")?Yr.Hotusa:void 0}(e)));if(r)return r;const n=function(e){const t=e.querySelector('script[src*="static.triptease.io/client-integrations/"]');if(!t)return;const[,r]=wt.get((()=>t.src.match(/\/([^/]+).js$/)))||[];return r?wt.get((()=>Yr.parse(r))):void 0}(e.document);return n||(i=e.document,wt.get((()=>{const e=i.querySelector('script[src*="onboard.triptease.io/bootstrap.js"]').src.match(/fallback=([a-zA-Z]+)/)[1];return Yr.parse(e)}),Yr.Default));var i}Yr.Lookup=new Map,Yr.AfricaAlbida=new Yr("AfricaAlbida"),Yr.Alaric=new Yr("Alaric"),Yr.Amadeus=new Yr("Amadeus"),Yr.Ascott=new Yr("Ascott"),Yr.Auberge=new Yr("Auberge"),Yr.AvailPro=new Yr("AvailPro"),Yr.Avvio=new Yr("Avvio"),Yr.Azimut=new Yr("Azimut"),Yr.BestWesternFrance=new Yr("BestWesternFrance"),Yr.BestWesternItaly=new Yr("BestWesternItaly"),Yr.BestWesternUk=new Yr("BestWesternUk"),Yr.Bode=new Yr("Bode"),Yr.BookAssist=new Yr("BookAssist"),Yr.BookEasy=new Yr("BookEasy"),Yr.BookOnlineNow=new Yr("BookOnlineNow"),Yr.BookVisit=new Yr("BookVisit"),Yr.Booking=new Yr("Booking"),Yr.Booking2Hotels=new Yr("Booking2Hotels"),Yr.BookingExpert=new Yr("BookingExpert"),Yr.BusyRooms=new Yr("BusyRooms"),Yr.CityExpress=new Yr("CityExpress"),Yr.ClaytonHotel=new Yr("ClaytonHotel"),Yr.Clock=new Yr("Clock"),Yr.CloudBeds=new Yr("CloudBeds"),Yr.Comwell=new Yr("Comwell"),Yr.ConstanceHotels=new Yr("ConstanceHotels"),Yr.Default=new Yr("Default"),Yr.DerqueBooking=new Yr("DerqueBooking"),Yr.DeutscheHospitality=new Yr("DeutscheHospitality"),Yr.DoyleCollection=new Yr("DoyleCollection"),Yr.EasyBooking=new Yr("EasyBooking"),Yr.Elina=new Yr("Elina"),Yr.EasyConsulting=new Yr("EasyConsulting"),Yr.EGds=new Yr("EGds"),Yr.Everly=new Yr("Everly"),Yr.ExtendedStayAmerica=new Yr("ExtendedStayAmerica"),Yr.Ezee=new Yr("Ezee"),Yr.FastBooking=new Yr("FastBooking"),Yr.Firmdale=new Yr("Firmdale"),Yr.FourSeasons=new Yr("FourSeasons"),Yr.Furama=new Yr("Furama"),Yr.Generic=new Yr("Generic"),Yr.GlenEagles=new Yr("GlenEagles"),Yr.GothiaTowers=new Yr("GothiaTowers"),Yr.GuestCentric=new Yr("GuestCentric"),Yr.GuestDesk=new Yr("GuestDesk"),Yr.GuestLine=new Yr("GuestLine"),Yr.Guild=new Yr("Guild"),Yr.HamiltonIsland=new Yr("HamiltonIsland"),Yr.HandPickedHotels=new Yr("HandPickedHotels"),Yr.Hart=new Yr("Hart"),Yr.Hayleys=new Yr("Hayleys"),Yr.HHotels=new Yr("HHotels"),Yr.HighLevelSoftware=new Yr("HighLevelSoftware"),Yr.Hipotels=new Yr("Hipotels"),Yr.Hoteliers=new Yr("Hoteliers"),Yr.HotelNetSolutions=new Yr("HotelNetSolutions"),Yr.Hotetec=new Yr("Hotetec"),Yr.Hotusa=new Yr("Hotusa"),Yr.Hoxton=new Yr("Hoxton"),Yr.HtiSystems=new Yr("HtiSystems"),Yr.Hyatt=new Yr("Hyatt"),Yr.Iberostar=new Yr("Iberostar"),Yr.InnQuest=new Yr("InnQuest"),Yr.InnRoad=new Yr("InnRoad"),Yr.InnStyle=new Yr("InnStyle"),Yr.Iperbooking=new Yr("Iperbooking"),Yr.IRM=new Yr("IRM"),Yr.Kasa=new Yr("Kasa"),Yr.Kempinski=new Yr("Kempinski"),Yr.Kognitiv=new Yr("Kognitiv"),Yr.LHW=new Yr("LHW"),Yr.Loews=new Yr("Loews"),Yr.Lotte=new Yr("Lotte"),Yr.Mews=new Yr("Mews"),Yr.Mirai=new Yr("Mirai"),Yr.NativePlaces=new Yr("NativePlaces"),Yr.NeoBookings=new Yr("NeoBookings"),Yr.NHCollection=new Yr("NHCollection"),Yr.NHHotels=new Yr("NHHotels"),Yr.OKU=new Yr("OKU"),Yr.Omnibees=new Yr("Omnibees"),Yr.OneHotels=new Yr("OneHotels"),Yr.Opera=new Yr("Opera"),Yr.Ovolo=new Yr("Ovolo"),Yr.PalaceResorts=new Yr("PalaceResorts"),Yr.Paraty=new Yr("Paraty"),Yr.Pegasus=new Yr("Pegasus"),Yr.Prestige=new Yr("Prestige"),Yr.PrimePlaza=new Yr("PrimePlaza"),Yr.ProfitRoom=new Yr("ProfitRoom"),Yr.Protel=new Yr("Protel"),Yr.PursuitCollection=new Yr("PursuitCollection"),Yr.RDP=new Yr("RDP"),Yr.RedPlanet=new Yr("RedPlanet"),Yr.RegalHotels=new Yr("RegalHotels"),Yr.ReserveHotel=new Yr("ReserveHotel"),Yr.ReserveOnline=new Yr("ReserveOnline"),Yr.Reservit=new Yr("Reservit"),Yr.Reztrip=new Yr("Reztrip"),Yr.RMSCloud=new Yr("RMSCloud"),Yr.RoomKey=new Yr("RoomKey"),Yr.Roiback=new Yr("Roiback"),Yr.SandsVegas=new Yr("SandsVegas"),Yr.Sbe=new Yr("Sbe"),Yr.Seekda=new Yr("Seekda"),Yr.Shr=new Yr("Shr"),Yr.SimpleBooking=new Yr("SimpleBooking"),Yr.SiteMinder=new Yr("SiteMinder"),Yr.StationCasinos=new Yr("StationCasinos"),Yr.Synxis=new Yr("Synxis"),Yr.SysHotelOnline=new Yr("SysHotelOnline"),Yr.Taj=new Yr("Taj"),Yr.Travelanium=new Yr("Travelanium"),Yr.TravelClick=new Yr("TravelClick"),Yr.Uibscrs=new Yr("Uibscrs"),Yr.VerticalBooking=new Yr("VerticalBooking"),Yr.Viato=new Yr("Viato"),Yr.Vinpearl=new Yr("Vinpearl"),Yr.Vizergy=new Yr("Vizergy"),Yr.WalkerHill=new Yr("WalkerHill"),Yr.WebRezPro=new Yr("WebRezPro"),Yr.Youngs=new Yr("Youngs"),Yr.Zafiro=new Yr("Zafiro"),Yr.ClientIntegration=new Set([Yr.BestWesternFrance,Yr.BusyRooms,Yr.Clock,Yr.DoyleCollection,Yr.Elina,Yr.Everly,Yr.Hayleys,Yr.HighLevelSoftware,Yr.Hoteliers,Yr.IRM,Yr.NativePlaces,Yr.PrimePlaza,Yr.RDP,Yr.RMSCloud,Yr.RoomKey,Yr.Vizergy,Yr.WalkerHill]),Yr.SelfIntegration=new Set([Yr.Avvio,Yr.BestWesternItaly,Yr.ClaytonHotel,Yr.ExtendedStayAmerica,Yr.FourSeasons,Yr.HtiSystems,Yr.LHW,Yr.NHCollection,Yr.NHHotels]);const rn=Ut("messaging");class nn{constructor(e){this.messageHandler=e,this.promises=new Map,e&&e.addListener((e=>{if($r(e)){const{correlationId:t}=e,r=this.promises.get(t);r&&(rn.debug("Sender matched response",e),r.resolve(e),this.promises.delete(t))}}))}handle(e){return n(this,void 0,void 0,(function*(){return rn.debug("Sending request",e),this.messageHandler&&this.messageHandler.send(e),new Promise(((t,r)=>{this.promises.set(e.correlationId,{resolve:t,reject:r})}))}))}}class sn{constructor(e,t,r=Ut("messaging")){this.listen=e,this.router=t,this.logger=r,this.rules=[],e.addListener(this.handler.bind(this)),this.addRule(Fr,(e=>e),(e=>e)),this.addRule(on,an,cn)}registerAlias(e,t){if(!this.router.hasHandlerFor(t))throw new Error(`Illegal alias: Method "${t}" is not registered with router`);return this.addRule((r=e,e=>e.type===r),function(e){return t=>({type:"triptease.onboard.request",requestType:String(e),payload:[t],correlationId:t.correlationId||"fire-and-forget"})}(t),cn);var r}handler(e,t){return n(this,void 0,void 0,(function*(){if($r(e))return;this.logger.debug("listenOn received request",e);const r=this.rules.find((t=>t.predicate(e)));if(!r)return;const n=r.requestConverter(e),i=yield this.router.handle(n);!function(e){return wt.get((()=>"NotFound"===e.payload.name),!1)}(i)?e.correlationId&&e.correlationId===i.correlationId&&(this.logger.debug("listenOn sending response to sender",i),t.send(r.responseConverter(i))):this.logger.debug(`Handler not found for request "${n.requestType}", potentially for another listener`)}))}addRule(e,t,r){return this.rules.push({predicate:e,requestConverter:t,responseConverter:r}),this}}function on(e){return!Fr(e)&&!!e.correlationId}function an(e){const{value:t,correlationId:r}=e,{method:n}=Xt(e.type);return{type:"triptease.onboard.request",requestType:n,payload:[t],correlationId:r}}function cn(e){return{type:"triptease.onboard.response",correlationId:e.correlationId,value:e.payload}}function ln(e){const t=Wt(e,"triptease-applications")||"auto";return wt.get((()=>{const[t]=class{static find(e){const t=["bootstrap.js","/paperboy/","/identity-service/confirm"].map((e=>`script[src*="${e}"][src*="triptease.io"]`));t.push('script[src*="triptease.net"]');const r=t.join(", ");return wt.Arrays.from(e.querySelectorAll(r)).map((e=>new l(e.src)))}}.find(e.document),{applications:r}=qt(t.query);return r}),t).toLowerCase()}var dn,un;(un=dn||(dn={})).Config="triptease.config",un.Error="triptease.onboard.error",un.Message="triptease.onboard.message",un.PageDisplayedSearch="triptease.integration.page_displayed_search",un.PageDisplayedRoomsAndRates="triptease.integration.page_displayed_rooms-and-rates",un.PageDisplayedConfirmation="triptease.integration.page_displayed_confirmation",un.PageDisplayedUnknown="triptease.integration.page_displayed_unknown",un.PageDisplayedGroup="triptease.integration.page_displayed_group",un.PageDisplayedPartial="triptease.integration.page_displayed_partial",un.PageErroredRoomsAndRates="triptease.integration.page_errored_rooms-and-rates",un.PageErroredConfirmation="triptease.integration.page_errored_confirmation",un.IntegrationData="triptease.integration.integration_data",un.PartialConfirmationPageData="triptease.integration.partial_confirmation_data",un.InvalidConfirmationData="triptease.integration.invalid_confirmation_data",un.InvalidPage="triptease.integration.invalid_page",un.GenericScript="triptease.integration.generic_script",un.DataCapture="triptease.integration.data_capture",un.GenericAnalysisConfirmation="triptease.integration.generic_analysis_confirmation",un.EntityUpdate="triptease.entity.update",un.StatusChanged="triptease.onboard.status-changed";class hn{constructor(e,t,r){this.window=e,this.messageBatcher=t,this.messageBuilder=r}static create(e,t,r){var n;const i=It(e).onboard;return i.trackingApi=null!==(n=i.trackingApi)&&void 0!==n?n:new hn(e,t,r)}get isEnabled(){return"none"!==ln(this.window)}trackConfig(e){return n(this,void 0,void 0,(function*(){this.isEnabled&&(wt.get((()=>e.payload.type===tr.Payment))||(yield this.messageBatcher.send(wt.Objects.removeEmpty(e))))}))}trackEvent(e){return n(this,void 0,void 0,(function*(){this.isEnabled&&(yield this.messageBatcher.send(e))}))}trackError(e){return n(this,void 0,void 0,(function*(){this.isEnabled&&(yield this.messageBatcher.send(yield this.messageBuilder.buildMessage({type:dn.Error,errorType:Yt(e)?"exception":"console",payload:e})))}))}trackMessage(e){return n(this,void 0,void 0,(function*(){this.isEnabled&&(yield this.messageBatcher.send(yield this.messageBuilder.buildMessage({type:dn.Message,payload:e})))}))}}class fn{constructor(e,t,r=Ut("integration-executor"),n=hr.create(e)){this.window=e,this.kernel=t,this.logger=r,this.starter=n}loadApplications(e){return n(this,void 0,void 0,(function*(){const t=ln(this.window);if("none"===t)return this.logger.log('applications set to "none", skipping loading'),{};const{integrationId:r,clientKey:n,apiKey:i}=e,{applications:s}=yield this.kernel.applicationConfig({integrationId:r,clientKey:n,apiKey:i}),o="auto"===t?s:s.filter((e=>e.name.toLowerCase()===t)),a=o.filter(lr);return this.logger.log("load applications",a),yield Promise.all(a.map((e=>wt.getAsync((()=>this.starter.start(e)))))),o.reduce(((e,t)=>(e[t.name]=!0,e)),{})}))}static create(e,t){var r;const n=It(e).triptease.onboard;return n.applicationLoader=null!==(r=n.applicationLoader)&&void 0!==r?r:new fn(e,t)}}const gn=Ut("events");class yn{constructor(e,t){this.timers=e,this.handle=t,this.finders=new Set,this.keepers=new WeakSet,this.handleEvent=e=>n(this,void 0,void 0,(function*(){try{if(gn.debug("Checking for new created items"),0===this.finders.size)return;const t=Array.from(this.finders).flatMap((e=>e()));t.reduce(((e,t)=>this.keepers.has(t)?e:(this.keepers.add(t),!0)),!1)&&(gn.log("Newly created element detected - firing event"),yield this.handle(e))}catch(e){gn.error("CreatedEvents.handleEvent threw while polling",e)}}))}start(){return n(this,void 0,void 0,(function*(){gn.log("Start polling for created items"),this.id=this.timers.setInterval(this.handleEvent,1e3)}))}stop(){return n(this,void 0,void 0,(function*(){gn.log("Stop polling for created items"),this.id&&(this.timers.clearInterval(this.id),this.id=void 0)}))}watch(e){e().forEach((e=>this.keepers.add(e))),this.finders.add(e)}}function pn(e){return new Promise((t=>{this.setTimeout((()=>{t()}),e)}))}class mn{constructor(e=new Br){this.clock=e,this.delay=pn.bind(this),this.delay=pn}task(e){return n(this,void 0,void 0,(function*(){return yield this.delay(0),e()}))}setTimeout(e,t){return setTimeout(e,t)}clearTimeout(e){clearTimeout(e)}setInterval(e,t){return setInterval(e,t)}clearInterval(e){clearInterval(e)}requestIdleCallback(e,t){const r=t?t.timeout:1;let n=this.clock.now().getTime()+r;const i=this;return this.setTimeout((()=>{e({didTimeout:!1,timeRemaining:()=>Math.max(0,50-(i.clock.now().getTime()-n))})}),r)}cancelIdleCallback(e){this.clearTimeout(e)}}new mn;const vn=Ut("events");class wn{constructor(e,t){this.window=e,this.delegate=t,this.first=!0,this.fire=e=>n(this,void 0,void 0,(function*(){!this.window.document.hidden||this.first?(yield this.delegate.fire(),this.first=!1):vn.log("Document hidden - skipping",e)}))}listen(e){return n(this,void 0,void 0,(function*(){yield this.delegate.listen(e)}))}removeListener(e){this.delegate.removeListener(e)}}const bn=Ut("events");class kn{constructor(e,t){this.delegate=e,this.running=t,this.fire=e=>n(this,void 0,void 0,(function*(){this.running.value?bn.log("Already running - skipping",e):(this.running.value=!0,yield this.delegate.fire(),this.running.value=!1)}))}listen(e){return n(this,void 0,void 0,(function*(){if(yield this.delegate.listen(e),this.running.value){bn.log("Already running - firing immediately");try{yield e()}catch(e){bn.log(e)}}}))}removeListener(e){this.delegate.removeListener(e)}}const On=Ut("events");class xn{constructor(){this.handlers=[],this.fire=e=>n(this,void 0,void 0,(function*(){On.log(`Firing handlers(${this.handlers.length})`,e),yield Promise.all(this.handlers.map((e=>n(this,void 0,void 0,(function*(){try{yield e()}catch(e){On.log("Error while firing handler",e)}})))))}))}listen(e){return n(this,void 0,void 0,(function*(){this.handlers.push(e)}))}removeListener(e){this.handlers=this.handlers.filter((t=>t!==e))}}const Sn=Ut("events");class In{constructor(e,t){this.timers=e,this.delegate=t,this.timeoutMs=1e3,this.timerId=0,this.fire=e=>n(this,void 0,void 0,(function*(){Sn.log(`Event observed, waiting for ${this.timeoutMs} ms quiet`,e),this.timers.clearInterval(this.timerId),this.timerId=this.timers.setTimeout((()=>n(this,void 0,void 0,(function*(){Sn.log("Event quiet period ended, firing event",e),yield this.delegate(e)}))),this.timeoutMs)}))}}const An=Ut("events");class En{constructor(e,t,r=.2,i=new mn){this.handle=e,this.running=t,this.idleThreshold=r,this.timers=i,this.lastState=!1,this.busy=!1,this.average=new Cn,this.idleHandler=e=>{const t=e.timeRemaining();this.running.value?this.busy=!1:0===t?this.busy=!0:(this.average=this.average.calculate(t),this.busy=this.average.percentage<-this.idleThreshold),this.busy?this.idleId=void 0:this.idleId=this.timers.requestIdleCallback(this.idleHandler,0===t?void 0:{timeout:t})},this.intervalHandler=()=>n(this,void 0,void 0,(function*(){this.stateHasChanged()&&this.isIdle()&&(An.log("Browser idle"),yield this.handle("Idle")),this.average=new Cn,this.lastState=this.busy,this.idleId||(this.idleId=this.timers.requestIdleCallback(this.idleHandler))}))}start(){return n(this,void 0,void 0,(function*(){this.intervalId=this.timers.setInterval(this.intervalHandler,1e3),this.idleId=this.timers.requestIdleCallback(this.idleHandler)}))}stop(){return n(this,void 0,void 0,(function*(){this.intervalId&&this.timers.clearInterval(this.intervalId),this.idleId&&this.timers.cancelIdleCallback(this.idleId)}))}isIdle(){return!this.busy}stateHasChanged(){return this.lastState!==this.busy}}class Cn{constructor(e=0,t=0,r=0,n=0){this.value=e,this.count=t,this.difference=r,this.percentage=n}calculate(e){const t=this.count+1,r=e-this.value,n=r/this.value,i=this.value+r/t;return new Cn(i,t,r,n)}}class Pn{constructor(e,t){this.window=e,this.handle=t}start(){return n(this,void 0,void 0,(function*(){this.window.addEventListener("visibilitychange",this.handle),this.window.addEventListener("popstate",this.handle),this.window.addEventListener("hashchange",this.handle),this.window.addEventListener("pageshow",this.handle),this.window.addEventListener("pagehide",this.handle),"complete"!==this.window.document.readyState?this.window.document.addEventListener("DOMContentLoaded",this.handle):yield this.handle("Document already loaded")}))}stop(){return n(this,void 0,void 0,(function*(){this.window.removeEventListener("visibilitychange",this.handle),this.window.removeEventListener("popstate",this.handle),this.window.removeEventListener("hashchange",this.handle),this.window.removeEventListener("pageshow",this.handle),this.window.removeEventListener("pagehide",this.handle),this.window.document.removeEventListener("DOMContentLoaded",this.handle)}))}}class Hn{constructor(){this.value=!1}}class jn{constructor(e,t=new mn){this.window=e;const r=new Hn;this.sink=new wn(e,new kn(new xn,r)),this.fire=new In(t,this.sink.fire).fire,this.mutation=new qn(this.fire),this.created=new yn(t,this.fire),this.sources=[new En(this.fire,r),this.mutation,this.created,new Pn(e,this.fire)]}watch(e){this.created.watch(e)}listen(e){return n(this,void 0,void 0,(function*(){yield this.sink.listen(e)}))}start(){return n(this,void 0,void 0,(function*(){yield Promise.all(this.sources.map((e=>e.start())))}))}stop(){return n(this,void 0,void 0,(function*(){this.sources.forEach((e=>e.stop()))}))}removeListener(e){this.sink.removeListener(e)}}function Tn(e){const t=It(e).triptease;return t.events=t.events||new jn(e)}const Ln={characterData:!0,attributes:!0,childList:!0};class qn{constructor(e){this.handle=e,this.observer=new MutationObserver(this.handle)}start(){return n(this,void 0,void 0,(function*(){}))}stop(){return n(this,void 0,void 0,(function*(){this.observer.disconnect()}))}static observe(e,t=Ln){if(!("MutationObserver"in wt.globalThis))return e;const r=Tn(wt.globalThis).mutation;return e instanceof HTMLInputElement||e instanceof HTMLSelectElement?e.addEventListener("change",r.handle):r.observer.observe(e,t),e}}Ut("messaging");const Rn=Ut("identity"),Bn="triptease-anonymous-id";class Mn{constructor(e){this.storage=e}getAnonymousIds(){return n(this,void 0,void 0,(function*(){const e=this.storage.get(Bn);return e?[e]:[]}))}setAnonymousId(e){return n(this,void 0,void 0,(function*(){const t=this.storage.get(Bn);(t&&e<t||!t)&&this.storage.set(Bn,e)}))}}class _n{constructor(e){this.storage=e,this.key="tt-domain-user-id",this.pattern=/[0-9A-Z]{26}/}getAnonymousIds(){return n(this,void 0,void 0,(function*(){const e=this.storage[this.key]||"";return this.pattern.test(e)?[e]:[]}))}setAnonymousId(e){return n(this,void 0,void 0,(function*(){}))}}class Nn{constructor(e){this.providers=e}static create(...e){return new Nn(e)}getAnonymousIds(){return n(this,void 0,void 0,(function*(){return wt.Arrays.unique(wt.Arrays.flatten(yield Promise.all(this.providers.map((e=>wt.get((()=>e.getAnonymousIds()),[])))))).sort()}))}setAnonymousId(e){return n(this,void 0,void 0,(function*(){yield Promise.all(this.providers.map((t=>wt.get((()=>t.setAnonymousId(e))))))}))}}class zn{constructor(e,t=new mr){this.delegate=e,this.generator=t}getAnonymousIds(){return n(this,void 0,void 0,(function*(){const e=(yield this.delegate.getAnonymousIds())[0]||this.generator.generate();return yield this.delegate.setAnonymousId(e),[e]}))}setAnonymousId(e){return this.delegate.setAnonymousId(e)}}class Dn{constructor(e,t,r=new mn){this.delay=e,this.delegate=t,this.timers=r,this.raceCounter=0}getAnonymousIds(){const e=this.raceCounter++;return Promise.race([(()=>n(this,void 0,void 0,(function*(){Rn.debug("TimeoutIdentityProvider delegate.getAnonymousIds called",e);const t=yield this.delegate.getAnonymousIds();return Rn.debug("TimeoutIdentityProvider delegate.getAnonymousIds returned",t,e),t})))(),this.wait(e)])}setAnonymousId(e){return n(this,void 0,void 0,(function*(){Rn.debug("TimeoutIdentityProvider delegate.setAnonymousId called",e),this.delegate.setAnonymousId(e)}))}wait(e){return n(this,void 0,void 0,(function*(){return yield this.timers.delay(this.delay),Rn.debug(`TimeoutIdentityProvider waited for ${this.delay} ms`,e),[]}))}}class Wn{constructor(e){this.storage=e}get(e){const t=this.storage.getItem(e);if(t)return Tt.parseWithDates(t)}set(e,t){return this.storage.setItem(e,JSON.stringify(t)),this}clear(){this.storage.clear()}}class Fn{constructor(){this.data=new Map}get(e){return this.data.get(e)}set(e,t){return this.data.set(e,t)}clear(){this.data.clear()}}class $n{constructor(e,t=2e3,r=new mn){this.handler=e,this.timeout=t,this.timers=r}handle(e){return n(this,void 0,void 0,(function*(){const t=yield Promise.race([this.handler.handle(e),this.timers.delay(this.timeout)]);return t||{type:Wr,payload:new Error(`Request ${e.requestType} timed out after ${this.timeout}`),correlationId:e.correlationId}}))}}class Gn{constructor(e,t=new Rr,r=Tn(e),i=new Dr(e),s=new _r(e,t),o=hn.create(e,s,i),a=new Vt("bootstrap",o),c=hr.create(e),l=new fr(e,a),d=new Ar(e,t),u=Tr.create(e)){this.window=e,this.clock=t,this.events=r,this.messageBuilder=i,this.messageBatcher=s,this.trackingApi=o,this.logger=a,this.starter=c,this.waiter=l,this.identityHelper=d,this.stackScripts=u,this.integrate=()=>n(this,void 0,void 0,(function*(){try{this.logger.log("Starting integrate()");const e=tn(this.window);It(this.window).onboard.integrationName=e;const t=function(e){return{name:e.name,url:e.script,type:"script"}}(e);yield this.starter.start(t)}catch(e){this.logger.error("Bootstrap.integrate: unhandled exception",e)}})),It(this.window).onboard.bootstrap=this}start(){return n(this,void 0,void 0,(function*(){try{this.logger.debug("Bootstrap starting"),Et.exposeApi(),this.stackScripts.capture();const[e,t]=yield Promise.all([this.identityHelper.getIdentity(),this.kernelFrame()]);this.identity=e;const r=t.contentWindow;if(!r)return void this.logger.log("Kernel frame did not generate a content window, aborting");const i=new Kt(this.window,r,[]),s=new $n(new nn(i));this.kernel=new jr(s),this.kernelHost=Hr(s),new sn(i,(new Kr).register(["processEvent"],new Jr(this)).register(["getAnonymousIds","setAnonymousId"],new Jr(new Nn(this.identityProviders))).register(["trackConfig","trackEvent","trackError","trackMessage"],new Jr(this.trackingApi))).registerAlias("triptease.event","processEvent").registerAlias("triptease.config","trackConfig"),fn.create(this.window,this.kernel),wt.getAsync((()=>n(this,void 0,void 0,(function*(){const[e]=yield new zn(new Nn([...this.identityProviders,new Dn(100,this.kernelHost)])).getAnonymousIds();this.identity.anonymousId=e,this.logger.log("anonymousId",e)})))),yield this.events.listen(this.integrate),yield this.events.start()}catch(e){this.logger.error("Bootstrap.start: unhandled exception",e)}}))}get identityProviders(){const e=[new Mn(new Fn),wt.get((()=>new Mn(new Wn(this.window.localStorage)))),new _n(wt.get((()=>this.window.localStorage),{}))];return this.window.opener&&e.push(new Dn(1e3,Hr(new nn(new Kt(this.window,this.window.opener,[]))))),e}reload(){return n(this,void 0,void 0,(function*(){this.logger.debug("Bootstrap reloading"),this.stackScripts.capture(),yield this.integrate()}))}kernelFrame(){return n(this,void 0,void 0,(function*(){const e=class{static application(e){const t=function(e=wt.globalThis){const t=Wt(e,Dt);return wt.Strings.isEmpty(t)?"":Rt({[Dt]:t})}();return{name:"triptease.onboard.kernel",url:`https://onboard.triptease.io/kernel/${sr.get()}/kernel-host.html?originHost=${e}${t?"&"+t:""}`,type:"iframe",startMessage:"triptease.onboard.kernel-host-started"}}}.application(this.window.location.hostname);return yield this.starter.start(e)}))}processEvent(e){return n(this,void 0,void 0,(function*(){const t=yield this.kernelHost.getPageState(),r=yield this.messageBuilder.buildMessage(Lt.merge(e,t));yield this.trackingApi.trackEvent(r)}))}}t([X.lazy,r("design:type",Array),r("design:paramtypes",[])],Gn.prototype,"identityProviders",null);const Un=Ut("bootstrap"),Vn=wt.get((()=>window.triptease.onboard.bootstrap));n(void 0,void 0,void 0,(function*(){const{"triptease-bootstrap-version":e=""}=qt(window.location.search);["none","noop"].includes(e.toLowerCase())||(Vn?(Un.log("Bootstrap reloading"),yield Vn.reload()):(Un.log("Creating new bootstrap"),yield new Gn(window).start()))}))}();